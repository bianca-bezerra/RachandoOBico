[gd_scene load_steps=52 format=3 uid="uid://c0icu2vkei1kc"]

[ext_resource type="Texture2D" uid="uid://brfwjd7p1p252" path="res://assets/ChickenPack/ChickenPack/SpriteSheet/Sprite-ChickenAttack-Sheet.png" id="2_7cbfe"]
[ext_resource type="Texture2D" uid="uid://c80c2eiwkyhbl" path="res://assets/ChickenPack/ChickenPack/SpriteSheet/ChickenDie-Sheet.png" id="3_7pk0n"]
[ext_resource type="Texture2D" uid="uid://c2bljhocno2sa" path="res://assets/ChickenPack/ChickenPack/SpriteSheet/ChickenFly-Sheet.png" id="4_3606j"]
[ext_resource type="Texture2D" uid="uid://g6csoon5erdj" path="res://assets/ChickenPack/ChickenPack/SpriteSheet/ChickenIdle-Sheet.png" id="5_8bm3i"]
[ext_resource type="Texture2D" uid="uid://dvbf1stu6cusd" path="res://assets/ChickenPack/ChickenPack/SpriteSheet/ChickenJumping-Sheet.png" id="6_vmnon"]
[ext_resource type="Texture2D" uid="uid://dbeeau1kk65wh" path="res://assets/ChickenPack/ChickenPack/SpriteSheet/ChickenDamage-Sheet.png" id="7_eitxh"]
[ext_resource type="Texture2D" uid="uid://drqmkdqaxcgtc" path="res://assets/ChickenPack/ChickenPack/SpriteSheet/ChickenWalking.png" id="8_lbqut"]

[sub_resource type="GDScript" id="GDScript_uk30o"]
script/source = "extends CharacterBody2D

#Motion
@export var speed = 300
@export var jump_force = -300
@export var double_jump_force : float = -300;
var gravity = ProjectSettings.get_setting(\"physics/2d/default_gravity\")
var current_direction = \"none\"

var direction

var has_double_jumped : bool = false;


#Animation
@onready var animation = $AnimatedSprite2D

#Combat System
@onready var OVO = preload(\"res://scenes/ovo.tscn\")

var enemy_inattack_range = false
var enemy_attack_cooldown = true
var health = 10
var knockback_vector := Vector2.ZERO
var is_alive = true
var damage_rate = 1
var attack_ip = false
var is_ondamage = false


	
func _physics_process(delta):
	
	player_movement(delta)
	attack()
	enemy_attack()
	attack()
	
	
func play_animation(movement):
	var dir = current_direction
	var animation = $AnimatedSprite2D
	
	if !is_on_floor():
		if attack_ip == false:
			if dir == \"right\":
				animation.flip_h = false
			elif dir == \"left\":
				animation.flip_h = true
			animation.play(\"jump\")
			
	elif dir == \"right\":
		animation.flip_h = false
		if movement == 1:
			animation.play(\"walk\")
		elif movement == 0:
			if attack_ip == false:
				animation.play(\"idle\")
			
	elif dir == \"left\":
		animation.flip_h = true
		if movement == 1:
			animation.play(\"walk\")
		elif movement == 0:
			if attack_ip == false:
				animation.play(\"idle\")
	

func player():
	pass
	
func player_movement(delta):
	
	if !is_on_floor():
		velocity.y += gravity * delta
		if velocity.y > 1000:
			velocity.y = 1000
	else:
		has_double_jumped = false;
			
	if Input.is_action_just_pressed(\"ui_accept\"):
		if is_on_floor() == true:
			velocity.y = jump_force
		elif not has_double_jumped:
			velocity.y = double_jump_force;
			has_double_jumped = false;

	elif Input.is_action_pressed(\"ui_right\"):
		current_direction = \"right\"
		play_animation(1)
		velocity.x = speed
		
	elif Input.is_action_pressed(\"ui_left\"):
		current_direction = \"left\"
		play_animation(1)
		velocity.x = -speed
	
	else:
		play_animation(0)
		velocity.x = 0
	
	if knockback_vector != Vector2.ZERO:
		velocity = knockback_vector
		
	move_and_slide()
	
func _on_hitbox_player_body_entered(body):
	if body.has_method(\"enemy\"):
		enemy_inattack_range = true
		
func _on_hitbox_player_body_exited(body):
	if body.has_method(\"enemy\"):
		enemy_inattack_range = false

func enemy_attack():
	if enemy_inattack_range == true and enemy_attack_cooldown == true:
		
		if health <= 0:
			is_alive = false
			health = 0
			self.queue_free()
			get_tree().change_scene_to_file(\"res://screens/scenes/game_over.tscn\")
		else:
			animation.play(\"take_damage\")
			if $RayRight.is_colliding() or $Ray2.is_colliding() or $Ray3.is_colliding():
				take_damage(Vector2(-1000,-400))
			elif $RayLeft.is_colliding() or $Ray1.is_colliding() or $Ray4.is_colliding():
				take_damage(Vector2(1000,-400))
			elif $RayUp.is_colliding():
				take_damage(Vector2(400,0))
			elif $RayDown.is_colliding():
				take_damage(Vector2(0,-1000))
		
		enemy_attack_cooldown = false
		$AttackCoolDown.start()
		
func _on_attack_cool_down_timeout():
	enemy_attack_cooldown = true

func attack():
	var dir = current_direction
	if Input.is_action_just_pressed(\"attack\"):
		global.player_current_attack = true
		attack_ip = true
		shoot()
		if dir == \"right\" or dir == \"none\":
			animation.flip_h = false
			animation.play(\"attack\")
			
			$AttackDeal.start()
		if dir == \"left\":
			animation.flip_h = true
			animation.play(\"attack\")
			
			$AttackDeal.start()
	
func _on_attack_deal_timeout():
	$AttackDeal.stop()
	global.player_current_attack = false
	attack_ip = false

func take_damage(knoback_force := Vector2.ZERO,duration := 0.15):
	is_ondamage = true
	health -= damage_rate
	if knoback_force != Vector2.ZERO:
		knockback_vector = knoback_force
		var knoback_tween = get_tree().create_tween()
		knoback_tween.tween_property(self, \"knockback_vector\", Vector2.ZERO, duration)

func shoot():
	var ovo_instace = OVO.instantiate()
	$Marker2D.add_child(ovo_instace)
"

[sub_resource type="AtlasTexture" id="AtlasTexture_l8tnb"]
atlas = ExtResource("2_7cbfe")
region = Rect2(0, 0, 34, 21)

[sub_resource type="AtlasTexture" id="AtlasTexture_qras7"]
atlas = ExtResource("2_7cbfe")
region = Rect2(34, 0, 34, 21)

[sub_resource type="AtlasTexture" id="AtlasTexture_ps1xr"]
atlas = ExtResource("2_7cbfe")
region = Rect2(68, 0, 34, 21)

[sub_resource type="AtlasTexture" id="AtlasTexture_5fi8d"]
atlas = ExtResource("2_7cbfe")
region = Rect2(102, 0, 34, 21)

[sub_resource type="AtlasTexture" id="AtlasTexture_rv7iw"]
atlas = ExtResource("2_7cbfe")
region = Rect2(136, 0, 34, 21)

[sub_resource type="AtlasTexture" id="AtlasTexture_5uw4d"]
atlas = ExtResource("2_7cbfe")
region = Rect2(170, 0, 34, 21)

[sub_resource type="AtlasTexture" id="AtlasTexture_i8dv7"]
atlas = ExtResource("2_7cbfe")
region = Rect2(204, 0, 34, 21)

[sub_resource type="AtlasTexture" id="AtlasTexture_lmdyu"]
atlas = ExtResource("2_7cbfe")
region = Rect2(238, 0, 34, 21)

[sub_resource type="AtlasTexture" id="AtlasTexture_hql02"]
atlas = ExtResource("2_7cbfe")
region = Rect2(272, 0, 34, 21)

[sub_resource type="AtlasTexture" id="AtlasTexture_mtms8"]
atlas = ExtResource("2_7cbfe")
region = Rect2(306, 0, 34, 21)

[sub_resource type="AtlasTexture" id="AtlasTexture_b65jo"]
atlas = ExtResource("3_7pk0n")
region = Rect2(0, 0, 20, 21)

[sub_resource type="AtlasTexture" id="AtlasTexture_40c8m"]
atlas = ExtResource("3_7pk0n")
region = Rect2(20, 0, 20, 21)

[sub_resource type="AtlasTexture" id="AtlasTexture_kqdrh"]
atlas = ExtResource("3_7pk0n")
region = Rect2(40, 0, 20, 21)

[sub_resource type="AtlasTexture" id="AtlasTexture_r363v"]
atlas = ExtResource("3_7pk0n")
region = Rect2(60, 0, 20, 21)

[sub_resource type="AtlasTexture" id="AtlasTexture_jwuok"]
atlas = ExtResource("4_3606j")
region = Rect2(0, 0, 32, 21)

[sub_resource type="AtlasTexture" id="AtlasTexture_t7h4d"]
atlas = ExtResource("4_3606j")
region = Rect2(32, 0, 32, 21)

[sub_resource type="AtlasTexture" id="AtlasTexture_abebv"]
atlas = ExtResource("4_3606j")
region = Rect2(64, 0, 32, 21)

[sub_resource type="AtlasTexture" id="AtlasTexture_afjo8"]
atlas = ExtResource("4_3606j")
region = Rect2(96, 0, 32, 21)

[sub_resource type="AtlasTexture" id="AtlasTexture_73dg5"]
atlas = ExtResource("4_3606j")
region = Rect2(128, 0, 32, 21)

[sub_resource type="AtlasTexture" id="AtlasTexture_4urym"]
atlas = ExtResource("5_8bm3i")
region = Rect2(0, 0, 20, 21)

[sub_resource type="AtlasTexture" id="AtlasTexture_wt65i"]
atlas = ExtResource("5_8bm3i")
region = Rect2(20, 0, 20, 21)

[sub_resource type="AtlasTexture" id="AtlasTexture_uhc7f"]
atlas = ExtResource("5_8bm3i")
region = Rect2(40, 0, 20, 21)

[sub_resource type="AtlasTexture" id="AtlasTexture_c3cba"]
atlas = ExtResource("5_8bm3i")
region = Rect2(60, 0, 20, 21)

[sub_resource type="AtlasTexture" id="AtlasTexture_icibe"]
atlas = ExtResource("5_8bm3i")
region = Rect2(80, 0, 20, 21)

[sub_resource type="AtlasTexture" id="AtlasTexture_rso56"]
atlas = ExtResource("6_vmnon")
region = Rect2(0, 0, 20, 21)

[sub_resource type="AtlasTexture" id="AtlasTexture_8fobo"]
atlas = ExtResource("6_vmnon")
region = Rect2(20, 0, 20, 21)

[sub_resource type="AtlasTexture" id="AtlasTexture_gw21x"]
atlas = ExtResource("6_vmnon")
region = Rect2(40, 0, 20, 21)

[sub_resource type="AtlasTexture" id="AtlasTexture_a4ak6"]
atlas = ExtResource("6_vmnon")
region = Rect2(60, 0, 20, 21)

[sub_resource type="AtlasTexture" id="AtlasTexture_5kt2m"]
atlas = ExtResource("6_vmnon")
region = Rect2(80, 0, 20, 21)

[sub_resource type="AtlasTexture" id="AtlasTexture_ijqnc"]
atlas = ExtResource("6_vmnon")
region = Rect2(100, 0, 20, 21)

[sub_resource type="AtlasTexture" id="AtlasTexture_a2yei"]
atlas = ExtResource("7_eitxh")
region = Rect2(0, 0, 20, 21)

[sub_resource type="AtlasTexture" id="AtlasTexture_hdk8h"]
atlas = ExtResource("7_eitxh")
region = Rect2(20, 0, 20, 21)

[sub_resource type="AtlasTexture" id="AtlasTexture_1yjrd"]
atlas = ExtResource("7_eitxh")
region = Rect2(40, 0, 20, 21)

[sub_resource type="AtlasTexture" id="AtlasTexture_sqdyf"]
atlas = ExtResource("7_eitxh")
region = Rect2(60, 0, 20, 21)

[sub_resource type="AtlasTexture" id="AtlasTexture_tpu3e"]
atlas = ExtResource("7_eitxh")
region = Rect2(80, 0, 20, 21)

[sub_resource type="AtlasTexture" id="AtlasTexture_ywuev"]
atlas = ExtResource("7_eitxh")
region = Rect2(100, 0, 20, 21)

[sub_resource type="AtlasTexture" id="AtlasTexture_snx3f"]
atlas = ExtResource("8_lbqut")
region = Rect2(0, 0, 20, 21)

[sub_resource type="AtlasTexture" id="AtlasTexture_17q2a"]
atlas = ExtResource("8_lbqut")
region = Rect2(20, 0, 20, 21)

[sub_resource type="AtlasTexture" id="AtlasTexture_8mtfx"]
atlas = ExtResource("8_lbqut")
region = Rect2(40, 0, 20, 21)

[sub_resource type="AtlasTexture" id="AtlasTexture_hcswt"]
atlas = ExtResource("8_lbqut")
region = Rect2(60, 0, 20, 21)

[sub_resource type="SpriteFrames" id="SpriteFrames_bssdy"]
animations = [{
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_l8tnb")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_qras7")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_ps1xr")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_5fi8d")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_rv7iw")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_5uw4d")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_i8dv7")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_lmdyu")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_hql02")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_mtms8")
}],
"loop": true,
"name": &"attack",
"speed": 10.0
}, {
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_b65jo")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_40c8m")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_kqdrh")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_r363v")
}],
"loop": true,
"name": &"death",
"speed": 5.0
}, {
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_jwuok")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_t7h4d")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_abebv")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_afjo8")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_73dg5")
}],
"loop": true,
"name": &"fly",
"speed": 5.0
}, {
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_4urym")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_wt65i")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_uhc7f")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_c3cba")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_icibe")
}],
"loop": true,
"name": &"idle",
"speed": 3.0
}, {
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_rso56")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_8fobo")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_gw21x")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_a4ak6")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_5kt2m")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_ijqnc")
}],
"loop": true,
"name": &"jump",
"speed": 5.0
}, {
"frames": [],
"loop": true,
"name": &"new_animation",
"speed": 5.0
}, {
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_a2yei")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_hdk8h")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_1yjrd")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_sqdyf")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_tpu3e")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_ywuev")
}],
"loop": true,
"name": &"take_damage",
"speed": 5.0
}, {
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_snx3f")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_17q2a")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_8mtfx")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_hcswt")
}],
"loop": true,
"name": &"walk",
"speed": 5.0
}]

[sub_resource type="CircleShape2D" id="CircleShape2D_w62ct"]
radius = 14.0

[sub_resource type="CircleShape2D" id="CircleShape2D_0o0mx"]
radius = 19.0263

[node name="GaloFrito" type="CharacterBody2D"]
position = Vector2(146, 100)
script = SubResource("GDScript_uk30o")

[node name="AnimatedSprite2D" type="AnimatedSprite2D" parent="."]
position = Vector2(-1.7113, -1.7174)
scale = Vector2(1.47113, 1.40166)
sprite_frames = SubResource("SpriteFrames_bssdy")
animation = &"death"
frame_progress = 0.47283

[node name="CollisionShape2D" type="CollisionShape2D" parent="."]
position = Vector2(-1, -3)
shape = SubResource("CircleShape2D_w62ct")

[node name="HitboxPlayer" type="Area2D" parent="."]

[node name="CollisionShape2D" type="CollisionShape2D" parent="HitboxPlayer"]
position = Vector2(-1, -1)
shape = SubResource("CircleShape2D_0o0mx")

[node name="AttackCoolDown" type="Timer" parent="."]
wait_time = 0.4

[node name="AttackDeal" type="Timer" parent="."]
wait_time = 0.4
one_shot = true

[node name="RayRight" type="RayCast2D" parent="."]
position = Vector2(12, 0)
target_position = Vector2(6, 0)

[node name="RayLeft" type="RayCast2D" parent="."]
position = Vector2(-15, 0)
target_position = Vector2(-6, 0)

[node name="RayUp" type="RayCast2D" parent="."]
target_position = Vector2(0, -20)

[node name="RayDown" type="RayCast2D" parent="."]
target_position = Vector2(0, 17)

[node name="Ray2" type="RayCast2D" parent="."]
target_position = Vector2(11, 11)

[node name="Ray1" type="RayCast2D" parent="."]
target_position = Vector2(-12, 11)

[node name="Ray3" type="RayCast2D" parent="."]
target_position = Vector2(14, -14)

[node name="Ray4" type="RayCast2D" parent="."]
target_position = Vector2(-13, -16)

[node name="Camera2D" type="Camera2D" parent="."]
zoom = Vector2(1.5, 1.5)
limit_left = 0

[node name="PlayDeath" type="Timer" parent="."]
wait_time = 5.0

[node name="Marker2D" type="Marker2D" parent="."]
position = Vector2(25, -1)

[connection signal="body_entered" from="HitboxPlayer" to="." method="_on_hitbox_player_body_entered"]
[connection signal="body_exited" from="HitboxPlayer" to="." method="_on_hitbox_player_body_exited"]
[connection signal="timeout" from="AttackCoolDown" to="." method="_on_attack_cool_down_timeout"]
[connection signal="timeout" from="AttackDeal" to="." method="_on_attack_deal_timeout"]
[connection signal="timeout" from="PlayDeath" to="." method="_on_play_death_timeout"]
